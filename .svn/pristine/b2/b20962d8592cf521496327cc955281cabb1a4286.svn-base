<?php

/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

/**
 * Description of KillProduct
 *
 * @author wangxiangshuai
 */
class KillProduct extends CI_Controller{
    //put your code here
    public function __construct() {
        parent::__construct();
        $this->load->model('KillProductModel');
        $this->load->helper('string');
    }
    
    public function get_killproducts(){
        $page = $this->input->post('page') ? $this->input->post('page') : 1;
        $limit = $this->input->post('limit') ? $this->input->post('limit') : 10;

        $killproductList = $this->KillProductModel->getKillProducts($page, $limit);

        foreach ($killproductList as &$product) {
            $product['thumb'] = reduce_double_slashes($this->systemsetting->get("img_url") . $this->systemsetting->get("file_upload_dir") . $product['thumb']);
        }

        $this->output->set_content_type("application/json")->set_output(json_encode(array('data' => $killproductList, 'error_code' => 0)));
    }
    
    public function get_killproduct() {
        $kill_product_id = $this->input->post("kill_product_id");
        $killproduct = $this->KillProductModel->getKillProduct($kill_product_id);
        if (!empty($killproduct)) {
            $killproduct['thumb'] = reduce_double_slashes($this->systemsetting->get("img_url") . $this->systemsetting->get("file_upload_dir") . $killproduct['thumb']);
            $images = unserialize($killproduct['images']);
            if (!empty($images)) {
                $killproduct['images'] = array();
                foreach ($images as $value) {
                    $killproduct['images'][] = reduce_double_slashes($this->systemsetting->get("img_url") . $this->systemsetting->get("file_upload_dir") . $value);
                }
            }
            if (empty($killproduct['kill_product_endtime'])) {
                $killproduct['kill_product_endtime'] = 260000;
            } else {
                $killproduct['kill_product_endtime'] -= time();
            }
        }
        
        $this->output->set_content_type("application/json")->set_output(json_encode(array('data' => $killproduct, 'error_code' => 0)));
    }

}
